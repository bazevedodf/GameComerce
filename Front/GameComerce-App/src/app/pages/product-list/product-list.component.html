<!-- product-list.component.html -->
<app-loading-spinner 
  [isLoading]="isLoading"
  message="Carregando produtos..."
  [subMessage]="textoCarregamento"
  [showProgress]="false">
</app-loading-spinner>
<div class="product-list-page min-vh-100 bg-light">
  
  <!-- Header da Página -->
  <section class="page-header bg-dark text-light py-4">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-md-12">
          <h3 class="fw-bold font-rajdhani mb-0">
            {{ pageTitle }}
          </h3>
          <p class="fs-6 ps-3 mb-0 text-warning" *ngIf="pageSubtitle">
            {{ pageSubtitle }}
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- Conteúdo Principal -->
  <div class="container py-4">
    <div class="row">
      
      <!-- Sidebar de Filtros -->
      <aside class="col-lg-3 mb-4 d-none d-lg-block">
        <div class="filters-sidebar card border-0 shadow-sm">
          <div class="card-header bg-white border-bottom">
            <h5 class="mb-0 fw-bold font-rajdhani">Filtros</h5>
          </div>
          
          <div class="card-body">
            
            <div class="search-active-badge mb-3" *ngIf="isSearchResults">
              <div class="alert alert-warning small mb-0 py-2">
                <i class="bi bi-search me-1"></i>
                Buscando: "{{ termoBusca }}"
              </div>
            </div>

            <!-- Filtro de Categorias -->
            <div class="filter-group mb-4">
              <h6 class="filter-title fw-semibold mb-3">Categorias</h6>
              <div class="filter-options">
                <div class="form-check mb-2" *ngFor="let categoria of categorias">
                  <input class="form-check-input" 
                         type="radio" 
                         name="categoria"
                         [id]="'cat-' + categoria.slug"
                         [value]="categoria.slug"
                         [(ngModel)]="categoriaSelecionada"
                         (change)="onFiltroChange()">
                  <label class="form-check-label small" [for]="'cat-' + categoria.slug">
                    {{ categoria.name }}
                  </label>
                </div>
                <button class="btn btn-link btn-sm p-0 text-muted small"
                        *ngIf="categoriaSelecionada"
                        (click)="categoriaSelecionada = ''; onFiltroChange()">
                  Limpar categoria
                </button>
              </div>
            </div>

            <!-- Botão Limpar Filtros -->
            <button class="btn btn-outline-secondary w-100"
                (click)="limparFiltros()"
                [disabled]="!categoriaSelecionada && !termoBusca">
              <i class="bi bi-arrow-clockwise me-2"></i>
              {{ isSearchResults ? 'Limpar Busca' : 'Limpar Filtros' }}
            </button>

          </div>
        </div>
      </aside>

      <!-- Lista de Produtos -->
      <main class="col-lg-9">
        
        <!-- Barra de Controles -->
        <div class="products-controls d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4 gap-3">
          
          <!-- Ordenação -->
          <div class="order-controls d-flex">
            <label class="form-label small fw-semibold text-muted me-2">Ordenar por:</label>
            <select class="form-select form-select-sm" 
                    style="width: auto;"
                    [(ngModel)]="ordenacao"
                    (change)="onFiltroChange()">
              <option value="relevancia">Relevância</option>
              <option value="preco-menor">Menor Preço</option>
              <option value="preco-maior">Maior Preço</option>
              <option value="avaliacao">Melhor Avaliado</option>
              <option value="nome">Nome A-Z</option>
            </select>
          </div>

          <!-- Info de Resultados -->
          <div class="results-info">
            <span class="text-muted small" *ngIf="!isLoading">
              {{ textoResultados }}
            </span>
          </div>

        </div>

        <!-- Loading -->
        <app-loading-spinner 
          [isLoading]="isLoading"
          message="Carregando produtos..."
          *ngIf="isLoading">
        </app-loading-spinner>

        <!-- Grid de Produtos -->
        <div class="row g-4" *ngIf="!isLoading && mostrarResultados">
          <div class="col-6 col-md-4 col-lg-4 col-xl-4" *ngFor="let produto of produtosPaginados">
            <app-product-card 
              [produto]="produto"
              (adicionadoAoCarrinho)="onProdutoAdicionado($event)">
            </app-product-card>
          </div>
        </div>

        <!-- Nenhum Resultado -->
        <div class="empty-state text-center py-5" *ngIf="!isLoading && !mostrarResultados">
          <i class="bi bi-search display-1 text-muted mb-3" *ngIf="isSearchResults"></i>
          <i class="bi bi-grid display-1 text-muted mb-3" *ngIf="!isSearchResults"></i>
          
          <h4 class="text-muted mb-3">
            {{ isSearchResults ? 'Nenhum resultado encontrado' : 'Nenhum produto disponível' }}
          </h4>
          
          <p class="text-muted mb-4">
            <span *ngIf="isSearchResults">
              Não encontramos produtos para "{{ termoBusca }}".<br>
              Tente outros termos ou limpe os filtros.
            </span>
            <span *ngIf="!isSearchResults">
              Tente ajustar os filtros ou buscar por outro termo.
            </span>
          </p>
          
          <button class="btn btn-warning fw-bold" (click)="limparFiltros()">
            <i class="bi bi-arrow-clockwise me-2"></i>
            {{ isSearchResults ? 'Limpar Busca' : 'Limpar Filtros' }}
          </button>
        </div>

        <!-- Paginação -->
        <nav *ngIf="!isLoading && mostrarPaginacao" class="mt-5">
          <ul class="pagination justify-content-center">
            <!-- Botão Anterior -->
            <li class="page-item" [class.disabled]="paginaAtual === 1">
              <a class="page-link" 
                 (click)="mudarPagina(paginaAtual - 1)"
                 aria-label="Previous">
                <i class="bi bi-chevron-left"></i>
              </a>
            </li>

            <!-- Páginas -->
            <li class="page-item" 
                *ngFor="let pagina of paginas" 
                [class.active]="pagina === paginaAtual">
              <a class="page-link" (click)="mudarPagina(pagina)">
                {{ pagina }}
              </a>
            </li>

            <!-- Botão Próximo -->
            <li class="page-item" [class.disabled]="paginaAtual === totalPaginas">
              <a class="page-link" 
                 (click)="mudarPagina(paginaAtual + 1)"
                 aria-label="Next">
                <i class="bi bi-chevron-right"></i>
              </a>
            </li>
          </ul>
        </nav>

      </main>
    </div>
  </div>
</div>